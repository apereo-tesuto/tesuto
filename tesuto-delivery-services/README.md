[[ Maketools Overview ]](./maketools/)
***

# CCC Assessment Delivery Docker Image

This is the CCC Assess Delivery microservice Docker container image abstracted and configurable.

This image assumes that the code from this project has already built the ccc-assess.war.

## Base Docker Image

* [tomcat-newrelic:1.0.0](https://bitbucket.org/cccnext/docker-base-tomcat/src/master/8/)

## Image Hierarchy

    |-- dockerhub/ubuntu 
        |-- base-image
            |-- base-java-8
                |-- tomcat-newrelic
                    |--> ccc-assess-delivery

## Tags

* latest
* 1.0.0

## Ports

* 8449 8086

## Environment Variables

Note that OPS will not allow Docker images to contain sensitive data such as passwords, therefore some of these variables will be removed in the near future.

key                                 | default value                               | description
------------------------------------|---------------------------------------------|--------------
JDBC_USER                           | tesuto_delivery                                 | DB User
JDBC_PASSWORD                       | tesuto_delivery                                   | DB Password
JDBC_URL                            | jdbc:postgresql://localhost:5432/tesuto_delivery  | Postgres DB Url
ALLOWED_HEADERS                     | Origin,X-Requested-With,Content-Type,Accept | Used for CORS. ** Do not put spaces between the values
ALLOWED_METHODS                     | POST,GET,PUT,OPTIONS,DELETE,HEAD            | Used for CORS. ** Do not put spaces between the values
ALLOWED_ORIGIN                      | *                                           | Used for CORS. ** Do not put spaces between the values
MAX_AGE                             | 3600                                        | Used for CORS. Time to live in seconds


## Setup

The data model will create itself when run for the first time. The datasource is defined by three environment variables. These must be set before running the service. 

```shell
export JDBC_USER=<your username>
export JDBC_PASSWORD=<your password>
export JDBC_URL=jdbc:postgresql://<your host>:5432/ccc-assess
```

## Proxy
If the service will be run behind a proxy then the following environment variables need to be set.

```shell
STUDENT_PROFILE_SERVICE_PROXY=<proxy host name>
STUDENT_PROFILE_SERVICE_PROXY_PORT=<proxy port>
STUDENT_PROFILE_SERVICE_PROXY_SCHEME=<http or https depending on the proxy>
```

## Usage

See [Maketools Overview](./maketools/) for additional usage details

### Build image
```shell
$ docker build -t docker.dev.ccctechcenter.org/ccc-assess:<tag> .
```
or
```shell
$ make build
```

### Run container
```shell
$ docker run --name ccc-assess-deliveryt --net=host -it --rm -p 8086:8086 -p 8449:8449 docker.dev.ccctechcenter.org/ccc-assess:<tag>
```
or
```shell
$ make run OPT="-p 8086:8086 -p 8449:8449"
```

## API Documentation
Documentation is automatically generated by maven. A zip distribution (jdondoc-distribution.zip) can be found in the target directory as well as an exploded view in target/jdondocui.

***
[[ Maketools Overview ]](./maketools/)