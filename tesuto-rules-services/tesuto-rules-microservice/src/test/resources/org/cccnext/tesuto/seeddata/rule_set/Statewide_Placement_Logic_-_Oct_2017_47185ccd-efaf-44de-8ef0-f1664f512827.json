{"id":"47185ccd-efaf-44de-8ef0-f1664f512827","family":"ZZ3","engine":"tesuto","version":"1","title":"Statewide Placement Logic - Oct 2017","status":"published","event":"PLACEMENT","category":"mmPlacementLogic","competencyMapDiscipline":"MATH","description":"When evaluating an assessment-based placement component and a multiple measures-based placement component, the statewide placement logic selects the highest level and course(s) into which a student can enroll.","ruleSetRowIds":[],"ruleSetDrl":"package org.cccnext.tesuto.rules;\n\nimport java.util.Date\nimport java.util.Map\nimport java.lang.Double\nimport java.lang.String\nimport java.util.List\nimport java.util.ArrayList\nimport java.util.HashMap\nimport java.util.Set\nimport java.util.HashSet\nimport java.util.stream.Collectors\nimport org.cccnext.tesuto.rules.view.BasicStudentView\nimport org.cccnext.tesuto.placement.view.PlacementComponentViewDto\nimport org.cccnext.tesuto.placement.view.PlacementRulesSourceDto\nimport org.cccnext.tesuto.placement.view.CompetencyAttributesViewDto\nimport org.cccnext.tesuto.domain.multiplemeasures.VariableSet\nimport org.cccnext.tesuto.domain.multiplemeasures.Fact\nimport org.cccnext.tesuto.domain.multiplemeasures.PlacementActionResult\nimport org.cccnext.tesuto.domain.multiplemeasures.PlacementComponentActionResult\n\nimport org.ccctc.common.droolscommon.RulesAction\nimport function org.cccnext.tesuto.rules.function.DrlFunctions.getHighestAndBestPlacementComponent\nimport function org.cccnext.tesuto.rules.function.DrlFunctions.getHighestAndBestPlacementComponentFromList\nimport function org.cccnext.tesuto.rules.function.DrlFunctions.COMPETENCY_ATTRIBUTES_KEY\nimport function org.cccnext.tesuto.rules.function.DrlFunctions.PLACEMENT_COMPONENTS_KEY\nimport function org.cccnext.tesuto.rules.function.DrlFunctions.RULE_SET_ID_KEY\n\n// Placement with MMAP component, no assessment component, isStandalonePlacement, isSelfReported\nrule \"rule_set_id:${rule_set_id}::rule_id:a4f1f0d3-39b0-4b09-930c-1b6a41a580ce\" when\n    map : Map()\n    ruleSetId : String(this == \"${rule_set_id}\") from map.get(RULE_SET_ID_KEY())\n    placementComponents : PlacementRulesSourceDto(mmapPlacementComponents : mmapPlacementComponents, assessmentPlacementComponents : assessmentPlacementComponents) from map.get(PLACEMENT_COMPONENTS_KEY())\n    eval(mmapPlacementComponents.size() > 0)\n    eval(assessmentPlacementComponents.size() == 0)\n    CompetencyAttributesViewDto(optInMultiMeasure == true, useSelfReportedDataForMM == true) from map.get(COMPETENCY_ATTRIBUTES_KEY())\n    bestComponent : PlacementComponentViewDto(standalonePlacement == true) from getHighestAndBestPlacementComponentFromList(placementComponents.mmapPlacementComponents, true, true)\n    then\n        List<RulesAction> actions = (List<RulesAction>) map.get(\"actions\");\n        PlacementActionResult placement = new PlacementActionResult();\n        placement.setCccid(bestComponent.getCccid());\n        placement.setCb21Code(bestComponent.getCb21().getCb21Code());\n        placement.setCourseGroup(bestComponent.getCourseGroup());\n        placement.setCollegeId(bestComponent.getCollegeId());\n        placement.setSubjectAreaId(bestComponent.getSubjectAreaId());\n        placement.setSubjectAreaVersion(bestComponent.getSubjectAreaVersion());\n        placement.setCreatedOn(new Date());\n        Set<String> placementComponentIds = new HashSet<>();\n        placementComponentIds.add(bestComponent.getId());\n        placement.setPlacementComponentIds(placementComponentIds);\n        placement.setElaIndicator(\"NA\");\n        placement.setTrackingId(bestComponent.getTrackingId());\n        placement.setRuleSetId(ruleSetId);\n        placement.setRuleId(\"a4f1f0d3-39b0-4b09-930c-1b6a41a580ce\");\n        RulesAction action = new RulesAction(\"PLACEMENT_ACTION\");\n        action.addActionParameter(\"placement\", placement);\n        actions.add(action);\nend\n\n// Placement with MMAP component, no assessment component, isStandalonePlacement, !isSelfReported\nrule \"rule_set_id:${rule_set_id}::rule_id:41d205b9-1d48-43a7-af45-fd5527b2117c\" when\n    map : Map()\n    ruleSetId : String(this == \"${rule_set_id}\") from map.get(RULE_SET_ID_KEY())\n    placementComponents : PlacementRulesSourceDto(mmapPlacementComponents : mmapPlacementComponents, assessmentPlacementComponents : assessmentPlacementComponents) from map.get(PLACEMENT_COMPONENTS_KEY())\n    eval(mmapPlacementComponents.size() > 0)\n    eval(assessmentPlacementComponents.size() == 0)\n    CompetencyAttributesViewDto(optInMultiMeasure == true, useSelfReportedDataForMM == false) from map.get(COMPETENCY_ATTRIBUTES_KEY())\n    bestComponent : PlacementComponentViewDto(standalonePlacement == true, selfReported == false) from getHighestAndBestPlacementComponentFromList(placementComponents.mmapPlacementComponents, true, false)\n    then\n        List<RulesAction> actions = (List<RulesAction>) map.get(\"actions\");\n        PlacementActionResult placement = new PlacementActionResult();\n        placement.setCccid(bestComponent.getCccid());\n        placement.setCb21Code(bestComponent.getCb21().getCb21Code());\n        placement.setCourseGroup(bestComponent.getCourseGroup());\n        placement.setCollegeId(bestComponent.getCollegeId());\n        placement.setSubjectAreaId(bestComponent.getSubjectAreaId());\n        placement.setSubjectAreaVersion(bestComponent.getSubjectAreaVersion());\n        placement.setCreatedOn(new Date());\n        Set<String> placementComponentIds = new HashSet<>();\n        placementComponentIds.add(bestComponent.getId());\n        placement.setPlacementComponentIds(placementComponentIds);\n        placement.setElaIndicator(\"NA\");\n        placement.setTrackingId(bestComponent.getTrackingId());\n        placement.setRuleSetId(ruleSetId);\n        placement.setRuleId(\"41d205b9-1d48-43a7-af45-fd5527b2117c\");\n        RulesAction action = new RulesAction(\"PLACEMENT_ACTION\");\n        action.addActionParameter(\"placement\", placement);\n        actions.add(action);\nend\n\n// Placement with MMAP component, assessment component, isSelfReported\nrule \"rule_set_id:${rule_set_id}::rule_id:c6db8be1-fffa-4cf8-8fa7-fd9086ca07ff\" when\n    map : Map()\n    ruleSetId : String(this == \"${rule_set_id}\") from map.get(RULE_SET_ID_KEY())\n    placementComponents : PlacementRulesSourceDto(mmapPlacementComponents : mmapPlacementComponents, assessmentPlacementComponents : assessmentPlacementComponents) from map.get(PLACEMENT_COMPONENTS_KEY())\n    eval(mmapPlacementComponents.size() > 0)\n    eval(assessmentPlacementComponents.size() > 0)\n    CompetencyAttributesViewDto(optInMultiMeasure == true, useSelfReportedDataForMM == true) from map.get(COMPETENCY_ATTRIBUTES_KEY())\n    bestAssessmentComponent : PlacementComponentViewDto() from getHighestAndBestPlacementComponentFromList(placementComponents.assessmentPlacementComponents)\n    bestMmapComponent : PlacementComponentViewDto() from getHighestAndBestPlacementComponentFromList(placementComponents.mmapPlacementComponents, false, true)\n    bestComponent : PlacementComponentViewDto() from getHighestAndBestPlacementComponent(bestAssessmentComponent, bestMmapComponent)\n    then\n        List<RulesAction> actions = (List<RulesAction>) map.get(\"actions\");\n        PlacementActionResult placement = new PlacementActionResult();\n        placement.setCccid(bestComponent.getCccid());\n        placement.setCb21Code(bestComponent.getCb21().getCb21Code());\n        placement.setCourseGroup(bestComponent.getCourseGroup());\n        placement.setCollegeId(bestComponent.getCollegeId());\n        placement.setSubjectAreaId(bestComponent.getSubjectAreaId());\n        placement.setSubjectAreaVersion(bestComponent.getSubjectAreaVersion());\n        placement.setCreatedOn(new Date());\n        Set<String> placementComponentIds = new HashSet<>();\n        placementComponentIds.add(bestAssessmentComponent.getId());\n        placementComponentIds.add(bestMmapComponent.getId());\n        placement.setPlacementComponentIds(placementComponentIds);\n        placement.setElaIndicator(bestAssessmentComponent == null ? \"NA\" : bestAssessmentComponent.getElaIndicator());\n        placement.setTrackingId(bestComponent.getTrackingId());\n        placement.setRuleSetId(ruleSetId);\n        placement.setRuleId(\"c6db8be1-fffa-4cf8-8fa7-fd9086ca07ff\");\n        RulesAction action = new RulesAction(\"PLACEMENT_ACTION\");\n        action.addActionParameter(\"placement\", placement);\n        actions.add(action);\nend\n\n// Placement with MMAP component, assessment component, !isSelfReported\nrule \"rule_set_id:${rule_set_id}::rule_id:078177d1-9636-4557-9178-12681e540637\" when\n    map : Map()\n    ruleSetId : String(this == \"${rule_set_id}\") from map.get(RULE_SET_ID_KEY())\n    placementComponents : PlacementRulesSourceDto(mmapPlacementComponents : mmapPlacementComponents, assessmentPlacementComponents : assessmentPlacementComponents) from map.get(PLACEMENT_COMPONENTS_KEY())\n    eval(mmapPlacementComponents.size() > 0)\n    eval(assessmentPlacementComponents.size() > 0)\n    CompetencyAttributesViewDto(optInMultiMeasure == true, useSelfReportedDataForMM == false) from map.get(COMPETENCY_ATTRIBUTES_KEY())\n    bestAssessmentComponent : PlacementComponentViewDto() from getHighestAndBestPlacementComponentFromList(placementComponents.assessmentPlacementComponents)\n    bestMmapComponent : PlacementComponentViewDto(selfReported == false) from getHighestAndBestPlacementComponentFromList(placementComponents.mmapPlacementComponents, false, false)\n    bestComponent : PlacementComponentViewDto() from getHighestAndBestPlacementComponent(bestAssessmentComponent, bestMmapComponent)\n    then\n        List<RulesAction> actions = (List<RulesAction>) map.get(\"actions\");\n        PlacementActionResult placement = new PlacementActionResult();\n        placement.setCccid(bestComponent.getCccid());\n        placement.setCb21Code(bestComponent.getCb21().getCb21Code());\n        placement.setCourseGroup(bestComponent.getCourseGroup());\n        placement.setCollegeId(bestComponent.getCollegeId());\n        placement.setSubjectAreaId(bestComponent.getSubjectAreaId());\n        placement.setSubjectAreaVersion(bestComponent.getSubjectAreaVersion());\n        placement.setCreatedOn(new Date());\n        Set<String> placementComponentIds = new HashSet<>();\n        placementComponentIds.add(bestAssessmentComponent.getId());\n        placementComponentIds.add(bestMmapComponent.getId());\n        placement.setPlacementComponentIds(placementComponentIds);\n        placement.setElaIndicator(bestAssessmentComponent == null ? \"NA\" : bestAssessmentComponent.getElaIndicator());\n        placement.setTrackingId(bestComponent.getTrackingId());\n        placement.setRuleSetId(ruleSetId);\n        placement.setRuleId(\"078177d1-9636-4557-9178-12681e540637\");\n        RulesAction action = new RulesAction(\"PLACEMENT_ACTION\");\n        action.addActionParameter(\"placement\", placement);\n        actions.add(action);\nend\n","ruleSetDrlValidationCsv":"fact,fact,fact,fact,fact,fact,fact,fact,fact,fact,fact,fact,fact,result,result,result,result,result,result,result,result,result,result,result\nruleSetId,optInMultiMeasure,useSelfReportedData,mmapComponent,mmapComponent,mmapComponent,mmapComponent,mmapComponent,assessComponent,assessComponent,assessComponent,assessComponent,assessComponent,cccid,cb21Code,courseGroup,collegeId,subjectAreaId,subjectAreaVersion,ruleSetId,ruleId,placementComponentIds,elaIndicator,trackingId\n${rule_set_id},true,true,1:12345:C:3:2017-01-01:1:college:1:1:true:true:ela1:12345,,,,,,,,,,12345,C,1,college,1,1,${rule_set_id},a4f1f0d3-39b0-4b09-930c-1b6a41a580ce,1,NA,12345\n${rule_set_id},true,false,1:12345:A:1:2017-01-01:1:college:1:1:false:false:ela1:12345,2:12346:B:2:2017-02-01:1:college:1:1:true:false:ela2:12346,3:12347:C:3:2017-03-01:1:college:1:1:false:false:ela3:12347,4:12348:D:4:2017-04-01:1:college:1:1:false:false:ela4:12348,5:12349:E:5:2017-05-01:1:college:1:1:true:false:ela5:12349,6:12350:A:1:2017-01-02:1:college:1:1:false:false:ela6:12350,7:12351:B:2:2017-02-02:1:college:1:1:false:false:ela7:12351,8:12352:C:3:2017-03-02:1:college:1:1:false:false:ela8:12352,9:12353:D:4:2017-04-02:1:college:1:1:false:false:ela9:12353,10:12354:E:5:2017-05-02:1:college:1:1:false:false:ela10:12354,12350,A,1,college,1,1,${rule_set_id},078177d1-9636-4557-9178-12681e540637,1:6,ela6,12350\n${rule_set_id},true,true,1:12345:A:1:2017-03-01:1:college:1:1:true:false:ela1:12345,2:12346:B:2:2017-02-01:1:college:1:1:true:false:ela2:12346,3:12347:C:3:2017-03-01:1:college:1:1:false:false:ela3:12347,4:12348:D:4:2017-04-01:1:college:1:1:false:false:ela4:12348,5:12349:E:5:2017-05-01:1:college:1:1:true:false:ela5:12349,6:12350:A:1:2017-01-02:1:college:1:1:false:false:ela6:12350,7:12351:B:2:2017-02-02:1:college:1:1:false:false:ela7:12351,8:12352:C:3:2017-03-02:1:college:1:1:false:false:ela8:12352,9:12353:D:4:2017-04-02:1:college:1:1:false:false:ela9:12353,10:12354:E:5:2017-05-02:1:college:1:1:false:false:ela10:12354,12345,A,1,college,1,1,${rule_set_id},c6db8be1-fffa-4cf8-8fa7-fd9086ca07ff,1:6,ela6,12345\n${rule_set_id},true,false,1:12345:A:1:2017-03-01:1:college:1:1:true:true:ela1:12345,2:12346:B:2:2017-02-01:1:college:1:1:true:true:ela2:12346,3:12347:C:3:2017-03-01:1:college:1:1:false:false:ela3:12347,4:12348:D:4:2017-04-01:1:college:1:1:false:true:ela4:12348,5:12349:E:5:2017-05-01:1:college:1:1:true:true:ela5:12349,,,,,,12348,D,1,college,1,1,${rule_set_id},41d205b9-1d48-43a7-af45-fd5527b2117c,4,NA,12348\n${rule_set_id},false,false,1:12345:A:1:2017-03-01:1:college:1:1:true:true:ela1:12345,2:12346:B:2:2017-02-01:1:college:1:1:true:true:ela2:12346,3:12347:C:3:2017-03-01:1:college:1:1:false:false:ela3:12347,4:12348:D:4:2017-04-01:1:college:1:1:false:true:ela4:12348,5:12349:E:5:2017-05-01:1:college:1:1:true:true:ela5:12349,,,,,,,,,,,,,,\n${rule_set_id},true,false,1:12345:A:1:2017-03-01:1:college:1:1:true:true:ela1:12345,2:12346:B:2:2017-02-01:1:college:1:1:true:true:ela2:12346,3:12347:C:3:2017-03-01:1:college:1:1:true:true:ela3:12347,4:12348:D:4:2017-04-01:1:college:1:1:true:true:ela4:12348,5:12349:E:5:2017-05-01:1:college:1:1:true:true:ela5:12349,,,,,,,,,,,,,,\n${rule_set_id},true,false,,,,,,6:12350:A:1:2017-01-02:1:college:1:1:false:false:ela6:12350,7:12351:B:2:2017-02-02:1:college:1:1:false:false:ela7:12351,8:12352:C:3:2017-03-02:1:college:1:1:false:false:ela8:12352,9:12353:D:4:2017-04-02:1:college:1:1:false:false:ela9:12353,10:12354:E:5:2017-05-02:1:college:1:1:false:false:ela10:12354,,,,,,,,,\n${rule_set_id},false,false,,,,,,6:12350:A:1:2017-01-02:1:college:1:1:false:false:ela6:12350,7:12351:B:2:2017-02-02:1:college:1:1:false:false:ela7:12351,8:12352:C:3:2017-03-02:1:college:1:1:false:false:ela8:12352,9:12353:D:4:2017-04-02:1:college:1:1:false:false:ela9:12353,10:12354:E:5:2017-05-02:1:college:1:1:false:false:ela10:12354,,,,,,,,,\n"}