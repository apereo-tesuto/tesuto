[[ Maketools Overview ]](./maketools/)
***

# Qti Import MicroService Image

This is the backing qti import microservice implementation abstracted and configurable.

This image assumes that the code from this project has already built the Spring Boot Service jar.

## Base Docker Image

* [base-java-8](https://bitbucket.org/cccnext/docker-base-java/src/master/8/)

## Image Hierarchy

    |-- dockerhub/ubuntu 
        |-- base-image
            |-- base-java-8
                |-- base-newrelic
                    |--> tesuto-qti-import

## Tags

tag   | notes
------|-----------------
1.0.0 | Initial release
1.1.0 | 
1.2.0 | 

## Ports

* 8087 8450

## Environment Variables

Note that OPS will not allow Docker images to contain sensitive data such as passwords, therefore some of these variables will be removed in the near future.

key                                 | default value                               | description
------------------------------------|---------------------------------------------|--------------
ALLOWED_HEADERS                     | Origin,X-Requested-With,Content-Type,Accept | Used for CORS. ** Do not put spaces between the values
ALLOWED_METHODS                     | POST,GET,PUT,OPTIONS,DELETE,HEAD            | Used for CORS. ** Do not put spaces between the values
ALLOWED_ORIGIN                      | *                                           | Used for CORS. ** Do not put spaces between the values
MAX_AGE                             | 3600                                        | Used for CORS. Time to live in seconds
RUN_FLYWAY                          | false                                       | Used for database version/migration


## Setup

The data model will create itself when run for the first time. The datasource is defined by three environment variables. These must be set before running the service. 

WARNING: developers running this locally should ALWAYS set the env var RUN_FLYWAY to true in order to get the correct database model

## Proxy
If the service will be run behind a proxy then the following environment variables need to be set.

```shell
ASSESSMENT_DELIVERY_SERVICE_PROXY=<proxy host name>
ASSESSMENT_DELIVERY_SERVICE_PROXY_PORT=<proxy port>
ASSESSMENT_DELIVERY_SERVICE_PROXY_SCHEME=<http or https depending on the proxy>
```

## Usage

See [Maketools Overview](./maketools/) for additional usage details

### Build the java artifact
```shell
$ mvn clean package
```

### Build image
```shell
$ make build
```

Alternately, you can do the maven and image creation all at once via:
```shell
$ make build-all
```

### Run container
```shell
$ docker run -p 8087:8087 -e SERVICES_SERVER=http://services.ccctech.org -e SMS_VERSION=v1 <registry-hostname>/service-qti-import:<tag>
```
or
```shell
$ make run OPT="-p 8087:8087 -e SERVICES_SERVER=http://services.ccctech.org -e SMS_VERSION=v1"
```

## API Documentation
Documentation is automatically generated by maven. A zip distribution (jdondoc-distribution.zip) can be found in the target directory as well as an exploded view in target/jdondocui.

***
[[ Maketools Overview ]](./maketools/)
